# 7 Days To Die

## Prerequisites

### Install Alloc's Server Fixes

Takaro requires [Alloc's Server Fixes](https://7dtd.illy.bz/wiki/Server%20fixes) to communicate with your 7D2D server. Most game hosting providers have this pre-installed - check with your host or look for a "Mods" section in your control panel.

> **Note:** The built-in 7D2D API doesn't yet support all operations Takaro needs. Once it does, Alloc's Fixes will no longer be required.

## Adding Your Server to Takaro

### Step 1: Set Up Web API Credentials

You need to run commands on your **game server's console** (not your local game). There are several ways to access this:

| Method | Where to find it |
|--------|------------------|
| **Game hosting panel** | Look for "Console", "Web Console", or "Command" in your hosting dashboard (Nitrado, G-Portal, Pingperfect, etc.) |
| **Web panel** | If Alloc's is installed, go to `http://<your-server-ip>:<webport>/` and use the console there |
| **Telnet** | Connect via telnet client to your server's telnet port (check your serverconfig.xml for `TelnetPort`) |
| **In-game** | Press F1 while connected to your server as an admin |

Once you have console access, run these commands:

1. Check for existing tokens:
```
   webtokens list
```

2. Create a new token:
```
   webtokens add <name> <token> 0
```

**Important:**
- The token must be **at least 10 characters** long
- The `0` at the end is required - this gives Takaro full API access
- Treat these credentials like a password - use a mix of letters, numbers, and symbols

**Example:**
```
webtokens add takaro Xy9$mK2pL#nQ 0
```

After running this, `takaro` is your **Auth Name** and `Xy9$mK2pL#nQ` is your **Auth Token** - you'll need both when adding the server to Takaro.

---

### Step 2: Find Your Web API Port

This is the port Alloc's webserver runs on - **not** your game port that players connect with.

#### Method 1: Check Server Logs (Most Reliable)

**Where to find logs:**
- **Game hosting panel:** Look for "Logs", "Console Log", or "Output Log" in your dashboard
- **Self-hosted:** Check `output_log.txt` or `7DaysToDieServer_Data/output_log.txt` in your server folder

**What to look for:**
```
2023-09-15T01:27:41 61.339 INF Started Webserver on 8082
```
The number at the end (`8082`) is your **Web API Port**.

#### Method 2: Check serverconfig.xml

**Where to find it:**
- **Game hosting panel:** Look for "Configuration", "Config Files", or "Settings" - find `serverconfig.xml`
- **Self-hosted:** In your server's root folder

**What to look for:**
```xml
<property name="WebDashboardPort" value="8082"/>
```

You can verify it's correct by visiting:
```
http://<your-server-ip>:<port>/legacymap
```
If you see the Allocs webmap, that's your port.

> ⚠️ Game hosting companies sometimes override config values internally - if the webmap doesn't load, use the log method instead.

---

### Step 3: Add Server to Takaro

In Takaro, go to **Servers → Add Server → 7 Days to Die** and enter:

| Field | Value | Example |
|-------|-------|---------|
| **Server IP** | Your server's IP address | `123.45.67.89` |
| **Web API Port** | The port from Step 2 | `8082` |
| **Auth Name** | The `<name>` from your webtokens command | `takaro` |
| **Auth Token** | The `<token>` from your webtokens command | `Xy9$mK2pL#nQ` |

---

## How Takaro Connects

Once configured, Takaro authenticates using your web token and establishes a Server-Sent Events (SSE) connection. This means Takaro receives events (player joins, chat messages, deaths, etc.) in real-time without constantly polling your server.

---

## Troubleshooting

### "Connection failed" or can't connect

1. **Wrong port?** Double-check using the server log method - hosting panels sometimes show incorrect info
2. **Token too short?** Must be at least 10 characters
3. **Missing permission?** Make sure you included the `0` at the end of the webtokens command
4. **Alloc's not installed?** Check your Mods folder for `Allocs_CommandExtensions`, `Allocs_CommonFunc`, and `Allocs_WebAndMapRendering`

### Can't access the webmap at all

- Your hosting provider may need to open/allow the web API port
- Check if a firewall is blocking the port
- Some hosts put the webmap on a different URL - check their documentation

### "Invalid token" error

- Tokens are case-sensitive - make sure you entered it exactly as created
- Try creating a new token with a simpler name (no special characters in the name)